---
title: "test_of_degree"
output: html_document
date: '2022-06-26'
---

```{r}

library(openxlsx)
library(R.matlab)


dir<-"D:/allGroups/Females_Mated/Assa_Females_MatedN_Unknown_RigA_20220208T121024"


#it is under the assumtion that there is 10 flys and they are orgenized in spcific way from the Allinteraction.mat
mat <- (readMat(paste0(dir, '/','Allinteraction.mat'))) # read each MAT file
sub_list_mat<-matrix(mat[["new.interactionFrameMatrix"]],nrow = 10, ncol = 10)
df_mat<-as.data.frame(sub_list_mat)



f <- function(x) {
    if(is.list(x)) lapply(x, f)
    else ifelse(length(x) == 0, 0, x)
  }

  
  #REMOVE 0 (MEAN NO INTERACTION)
  for(i in 1:ncol(df_mat)){
    for(j in 1:nrow(df_mat)){
      if(length(unlist(df_mat[i,j])) == 0){
        df_mat[i,j] <- lapply(df_mat[i,j], function(x)x[lengths(x) == 0] <- 0)
      }
    }
  }
  
  df_mat<-na.omit(df_mat)
  
  
  colnames(df_mat)<-c("1","2","3","4","5","6","7","8","9","10")
  rownames(df_mat)<-c("1","2","3","4","5","6","7","8","9","10")
  
  all<-data.frame()
  
  number_of_flys<-10
  for(i in 1:number_of_flys){
    for(j in 1:number_of_flys){
      if(length(unlist(sub_list_mat[i,j]))!=0){
        temp_num_frames<-unlist(df_mat[i,j])

        #the value from where the diffrence is bigger than 120 in the next frame
        idx <- c(0, cumsum(abs(diff(temp_num_frames)) > 120))
          splited_frames<-split(temp_num_frames, idx)
        if(length(splited_frames)> 0){
            firsts_elemts<<-lapply(splited_frames, `[[`, 1)
            last_elemnts<-lapply(splited_frames, function(x) x[length(x)])


            for(number_of_elemnts in 1:length(firsts_elemts)){
            tobind<-c(colnames(df_mat[i]),rownames(df_mat[j,]))
            tobind<-as.data.frame(t(tobind))
              tobind<-cbind(tobind,firsts_elemts[number_of_elemnts])
              tobind<-cbind(tobind,last_elemnts[number_of_elemnts])
              colnames(tobind)<-c("tail","head","onset","terminus")

              all<-rbind(all,tobind)

            }
            
        }else{
          print(i)
          print(j)
          print("check this")
          
        }
        
      }
        
    }
  }  



```

## Including Plots
