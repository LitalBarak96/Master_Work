---
title: "biggest_component_changes"
output: html_document
date: '2022-06-30'
---


```{r}


library(openxlsx)
library(stringr)
library(dplyr)
library(reshape2)
library(igraph)
library(R.matlab)



f <- function(x) {
    if(is.list(x)) lapply(x, f)
    else ifelse(length(x) == 0, 0, x)
}



number_of_flys<-10
number_of_frame<-1

#seq by the  number of frames
numbers<-seq(1, 27001, by=number_of_frame)



dir<-list.dirs(recursive = F,path = "D:/allGroups/Females_Mated")


num_of_movie=11

  mat <- (readMat(paste0(dir[num_of_movie], '/','Allinteraction.mat'))) # read each MAT file
  sub_list_mat<-matrix(mat[["new.interactionFrameMatrix"]],nrow = number_of_flys, ncol = number_of_flys)
  df_mat<-as.data.frame(sub_list_mat)
  

    for(i in 1:ncol(df_mat)){
    for(j in 1:nrow(df_mat)){
      if(length(unlist(df_mat[i,j])) == 0){
        df_mat[i,j] <- lapply(df_mat[i,j], function(x)x[lengths(x) == 0] <- 0)
      }
    }
  }
  
  df_mat<-na.omit(df_mat)

  

  #10 flys
  
  
  colnames(df_mat)<-c(1:number_of_flys)
  rownames(df_mat)<-c(1:number_of_flys)
  
  
  all<-data.frame()
  path_to_sub_Scripts<-"C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/code/interactions_network/dynamic/sub_scripts"
  
   setwd(path_to_sub_Scripts)
    files.sources = list.files()
    sapply(files.sources, source)

  all<-all_frames_interaction_above(number_of_flys,sub_list_mat,df_mat)

  #for the acasct every interaction mean 1 
  all<-cbind(all,1)


  library(dplyr)
  library(igraph)
  
  previous_net<-creat_network(all,1,numbers)

  all_changes<-NULL
for(i in 2:(length(numbers)-1)){
  
  current_net<-creat_network(all,i,numbers)
  
  
  #check who really have bigger than 3 cc
  sub_prev_net<-biggest_cc_subgraph(previous_net)
  if(sub_prev_net[[2]] == FALSE){
    # no sub cluster bigger than 3
    sub_prev_net<-(sub_prev_net[[1]])
    size_of_biggest_cc = 0
  }else{
    sub_prev_net<-(sub_prev_net[[1]])
    size_of_biggest_cc= length(sub_prev_net)
  }
  
  
  
  sub_current_net<-biggest_cc_subgraph(current_net)
    if(sub_current_net[[2]] == FALSE){
    # no sub cluster bigger than 3
    sub_current_net<-(sub_current_net[[1]])
    size_of_biggest_cc_current = 0
  }else{
    sub_current_net<-(sub_current_net[[1]])
    size_of_biggest_cc_current= length(sub_current_net)
  }
  
  #if there is a component that is bigger than 3 nodes,the if is inside biggest_cc_subgraph script
  #the biggest cc is 3 but the chnages is 2 and not 3 because if added the

  #only if there is cc that is bigger than 3
 #if(size_of_biggest_cc_current>=3){
    
  #i need to consider to make subtraction on each over if always one of them is 0
  #reverse=length(E(difference(sub_prev_net,g1)))-length(E(difference(u2,u1)))
#if the edges is in one of them 
  changes_in_edges <- length(E(difference(sub_prev_net,sub_current_net)))+length(E(difference(sub_current_net,sub_prev_net)))
  #bigeest cc show the cc if it is bigger than 3,else it is 0
  tmp<-data.frame(change = changes_in_edges,frame = i,size_cc = size_of_biggest_cc_current)
  all_changes<-rbind(all_changes,tmp)
  print(i)
#if(commEdges1 == 0){
  
  #diff = commEdges2
  #  warning("diff1 is 0 and diff2 is")
 #     print(diff)
#}else if(commEdges2 == 0){
   #diff = commEdges1
     # warning("diff2 is 0 and diff1 is")
    #print(diff)

    #}else{
  #print("both diffs are")
  #diff=0
 # print(diff)
#}
  
  
#  }

previous_net<-current_net
}  

  
  
  library(ggplot2)
library(reshape2)



# melt the data to a long format
df2 <- melt(data = all_changes, id.vars = "frame")

# plot, using the aesthetics argument 'colour'
#ggplot(data = df2, aes(x = frame, y = value, colour = variable)) + geom_line()
  


cc_and_change<-ggplot(df2, aes(frame,value,colour = variable)) + 
  geom_point() + 
  geom_line() +
  facet_wrap(~variable)

library(ggplot2)
  #work if they are on the same scale
  #ggplot(all_changes, aes(frame)) +                    # basic graphical object
  #geom_line(aes(y=size_cc), colour="red") +  # first layer
  #geom_line(aes(y=change), colour="green") 
#P<-ggplot(data =all_changes, aes(frame, change))+geom_line()
plot(cc_and_change)
```
